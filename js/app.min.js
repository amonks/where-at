function initialize(){var e={disableDefaultUI:!0,panControl:!1,zoomControl:!1,zoom:10,mapTypeControl:!1,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}};map=new google.maps.Map(document.getElementById("map-canvas"),e);load(),drawingManager.setMap(map),google.maps.event.addListener(drawingManager,"overlaycomplete",function(e){var o="|"+e.type;switch(e.type){case google.maps.drawing.OverlayType.MARKER:o+=e.overlay.getPosition()+"",constructMarker(o);break;case google.maps.drawing.OverlayType.RECTANGLE:o+=e.overlay.getBounds()+"";break;case google.maps.drawing.OverlayType.CIRCLE:o+=e.overlay.getCenter()+"",o+=e.overlay.getRadius()+"";break;default:path=e.overlay.getPath();for(var a=0;a<path.length;a++)o+=path.getAt(a)+";";constructPolyline(o)}console.log(o),save.add(o)}),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){var o=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);map.setCenter(o)},function(){handleNoGeolocation(!0)}):handleNoGeolocation(!1);var o=[],a=document.getElementById("pac-input");map.controls[google.maps.ControlPosition.TOP_LEFT].push(a);var n=new google.maps.places.SearchBox(a);google.maps.event.addListener(n,"places_changed",function(){for(var e,a=n.getPlaces(),t=0;e=o[t];t++)e.setMap(null);o=[];for(var r,t=(new google.maps.LatLngBounds,0);r=a[t];t++){var l={url:r.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)},e=new google.maps.Marker({map:map,icon:l,title:r.name,position:r.geometry.location});o.push(e),r.geometry.viewport?map.fitBounds(r.geometry.viewport):(map.setCenter(r.geometry.location),map.setZoom(17))}}),google.maps.event.addListener(map,"bounds_changed",function(){var e=map.getBounds();n.setBounds(e)})}function handleNoGeolocation(e){if(e)var o="Error: Couldn't find your location.";else var o="Error: Your browser doesn't support geolocation.";{var a={map:map,position:new google.maps.LatLng(41.880454799999995,-87.6251393),content:o};new google.maps.InfoWindow(a)}map.setCenter(a.position)}function randomColor(){return"#"+Math.floor(16777215*Math.random()).toString(16)}function saveImage(){$("body").html2canvas();var e=html2canvas.Parse(),o=html2canvas.Renderer(e,{elements:{length:1}}),a=o.toDataURL();window.open(a)}function SaveData(){this.drawLog=""}function constructPolyline(e){var o,a=e.replace("polyline","").replace(/\(/g,"").replace(/\)/g,"").split(";");console.log(a);for(var n=new google.maps.MVCArray,t=a.length-2;t>=0;t--){console.log(a[t].split(", "));var o=a[t].split(", ");n.push(new google.maps.LatLng(parseFloat(o[0]),parseFloat(o[1])))}new google.maps.Polyline({path:n,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:5,map:map})}function constructMarker(e){var o=e.replace("marker","").replace(/\(/g,"").replace(/\)/g,"").split(", "),a=new google.maps.MVCArray;a.push(new google.maps.LatLng(parseFloat(o[0]),parseFloat(o[1]))),a.forEach(function(e){createMarker({map:map,position:e})})}function createMarker(e){var o=new google.maps.Marker(e);return google.maps.event.addListenerOnce(o,"click",function(){o.setMap(null),o=null}),o}function getQueryString(){if(-1==window.location.href.indexOf("?"))return null;var e=window.location.href.slice(window.location.href.indexOf("?")+1);return e.length<=1?null:atob(e)}function getOverlayArray(){return getQueryString().split("|")}function load(){for(var e=getOverlayArray(),o=e.length-1;o>=0;o--)-1!==e[o].indexOf("polyline")&&constructPolyline(e[o]),-1!==e[o].indexOf("marker")&&constructMarker(e[o])}var save=new SaveData,map,drawingManager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYLINE,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_LEFT,drawingModes:[google.maps.drawing.OverlayType.POLYLINE,google.maps.drawing.OverlayType.MARKER]},polylineOptions:{strokeWeight:5,strokeOpacity:.5,strokeColor:"#ff0000",clickable:!1,zIndex:1,editable:!1},polygonOptions:{editable:!1},markerOptions:{editable:!1}});SaveData.prototype.base64=function(){return btoa(this.drawLog)},SaveData.prototype.add=function(e){this.drawLog+=e},google.maps.event.addDomListener(window,"load",initialize);