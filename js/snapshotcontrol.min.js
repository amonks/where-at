function SnapShotControl(e){var t=this;this.hProcDic_={},this.overlays_=new google.maps.MVCArray,this.createBtn_=function(e,o){var i=t.createDiv_({borderStyle:"solid",borderWidth:"1px",borderColor:"black",color:"black",backgroundColor:"white",cursor:"pointer",whiteSpace:"nowrap",margin:"5px",fontSize:"inherit",lineHeight:"inherit"});e.match(/</)||(i.style.height="1em",i.style.fontSize="12px",i.style.fontFace="Arial,sans-serif",i.style.fontSize="12px");var n=t.getHtmlSize(e);t._is_gecko&&e.match(/</)&&(n.width+=3,n.height+=3),i.style.width=n.width+"px",i.style.height=n.height+"px";var s=t.createDiv_({textAlign:"center",borderColor:"#D0D0D0 #707070 #707070 #D0D0D0",borderWidth:"1px",borderStyle:"solid",WebkitUserSelect:"none",MozUserSelect:"none",cursor:"pointer",fontSize:"inherit",lineHeight:"inherit",position:"static",height:n.height-2+"px"});return e.match(/</)||(s.style.fontFace="Arial,sans-serif",s.style.fontSize="12px"),s.innerHTML=e,i.appendChild(s),t.isNull(o)||google.maps.event.addDomListener(s,"click",o),i},this.setStyles_=function(e,o){var i;if(!t.isNull(o))for(i in o)i in e.style&&(e.style[i]=o[i]);return e},this.isNull=function(e){return!e&&0!==e||void 0===e||""===e||null===e||"undefined"==typeof e?!0:!1},this.checkBrowserAgent=function(){var e=navigator.userAgent.toLowerCase();t._is_ie=-1!==e.indexOf("msie")&&-1===e.indexOf("opera"),t._is_ie7=-1!==e.indexOf("msie 7"),t._is_ie8=t._is_ie===!0&&t._is_ie7===!1,t._is_gecko=-1!==e.indexOf("gecko"),t._is_opera=-1!==e.indexOf("opera"),t._is_chrome=-1!==e.indexOf("chrome")},this.createDiv_=function(e){t.isNull(e)&&(e={});var o,i={position:"absolute",fontSize:0,lineHeight:0,overflow:"hidden"};for(o in i)!(o in e)&&o in i&&(e[o]=i[o]);var n=document.createElement("div");return n=t.setStyles_(n,e)},this.getHtmlSize=function(e){var o=t.map_.getDiv();e.match(/</)||(e="<span>"+e+"</span>");var i=document.createElement("div");o.appendChild(i);var n,s,r=function(e){var t=document.createElement("span");i.appendChild(t),t.innerHTML=e;var o,n=t.getElementsByTagName("*");for(o=0;o<n.length;o++)1===n[o].nodeType&&(n[o].style.margin=0);t.style.whiteSpace="nowrap";var s={};return s.width=t.offsetWidth,s.height=t.offsetHeight,s},a=e.split(/\n/i),l=new google.maps.Size(1,1);for(s=0;s<a.length;s++)n=r(a[s]),n.width>l.width&&(l.width=n.width),l.height+=n.height;return o.removeChild(i),l},this.setHookProcForMarker_=function(){var e="Marker";t.hProcDic_[e]=google.maps[e],e in google.maps&&(google.maps[e]=function(o){var i=t.replaceFunc_(new t.hProcDic_[e](o),"setOptions",function(e){i.set("options",e),i.setOptions_.call(i,e)}),n=typeof o.icon;if("string"===n.toLowerCase())i.set("iconUrl",o.icon);else if(!t.isNull(o.icon)){var s=o.icon.getArguments();i.set("iconUrl",s[0])}return i.set("options",o),i.setIcon_=i.setIcon,i.setIcon=function(e){var n=typeof o.icon;if("string"===n.toLowerCase())i.set("iconUrl",e);else{if(!t.isNull(o.icon)){var s=e.getArguments();i.set("iconUrl",s[0])}i.setIcon_.call(i,e)}},i=t.setFunc_(i,"getOptions",function(){return i.get("options")}),i.set("sncOverNo",t.overlays_.getLength()),i.set("sncCls",e),t.overlays_.push(i),i})},this.setHookProc_=function(e){t.hProcDic_[e]=google.maps[e],e in google.maps&&(google.maps[e]=function(o){var i=t.replaceFunc_(new t.hProcDic_[e](o),"setOptions",function(e){i.set("options",e),i.setOptions_.call(i,e)});return i.set("options",o),i.getOptions=function(){return i.get("options")},i.set("sncOverNo",t.overlays_.getLength()),i.set("sncCls",e),t.overlays_.push(i),i})},this.replaceFunc_=function(e,t,o,i){return e[t+"_"]=e.b,e.c=i,e},this.setFunc_=function(e,t,o){return e.b=o,e},this.setHookArg_=function(e){e in google.maps&&(t.hProcDic_[e]=google.maps[e],google.maps[e]=function(o,i,n,s,r){var a=arguments,l=new t.hProcDic_[e](o,i,n,s,r);return l.getArguments=function(){return a},"get"in l?l.set("sncCls",e):l.get=function(t){return"sncCls"===t?e:void 0},l})},this.getImage=function(e){var o="http://"+t.server_+"/maps/api/staticmap?",i=t.map_.getBounds(),n=!1,s=t.map_.getDiv(),r=new google.maps.Size(s.offsetWidth,s.offsetHeight);t.isNull(t.opts_.size)?(r.width>640&&(r.width=640),r.height>640&&(r.height=640),o+="size="+r.width+"x"+r.height,r.width=parseInt(r.width,10),r.height=parseInt(r.height,10)):(t.opts_.size.width>640&&(t.opts_.size.width=640),t.opts_.size.height>640&&(t.opts_.size.height=640),o+="size="+t.opts_.size.width+"x"+t.opts_.size.height,r.width=parseInt(t.opts_.size.width,10),r.height=parseInt(t.opts_.size.height,10)),t.mapImgSize=r;var a="";if(t.isNull(t.opts_.maptype)){switch(t.map_.getMapTypeId()){case google.maps.MapTypeId.SATELLITE:a="satellite";break;case google.maps.MapTypeId.HYBRID:a="hybrid";break;case google.maps.MapTypeId.TERRAIN:a="terrain";break;case google.maps.MapTypeId.ROADMAP:a="roadmap"}if(""!==a)o+="&maptype="+a;else{var l=t.map_.mapTypes.get(t.map_.getMapTypeId());if("StyledMapType"===l.get("sncCls")){var g=l.getArguments();if(!t.isNull(g[0])){var p,h,c,u,d,m,f=g[0];for(p in f)if(p in f){o+="&style=feature:"+f[p].featureType+"|element:"+f[p].elementType,m=[];for(c in f[p].stylers)if(c in f[p].stylers){d=f[p].stylers[c];for(u in d)"_"!==u[0]&&(h=d[u],"hue"===u&&(h=h.replace("#","0x")),m.push(u+":"+h))}m.length&&(o+="|"+m.join("|"))}}}else o+="&maptype=roadmap"}}else o+="&maptype="+t.opts_.maptype.toLowerCase();if(""!==t.opts_.language&&(o+="&hl="+t.opts_.language),!t.isNull(t.opts_.format)){var _=t.opts_.format.toLowerCase();"jpg"===_||"jpeg"===_?o+="&format=jpg":"png"===_?o+="&format=png32":("jpg-baseline"===_||"png8"===_||"png32"===_)&&(o+="&format="+_)}var y=[];t.overlays_.forEach(function(e,s){y=[];var r=e.get("sncCls");if(e.getMap()===t.map_&&("Circle"===r||"Polyline"===r||"Polygon"===r||"Rectangle"===r)){{var a;e.getOptions()}if("Circle"===r){a=new google.maps.MVCArray;var l,g=e.getCenter(),p=e.getRadius();for(s=0;36>=s;s++)l=t.circlePoint_(g,360*s/36,p/1e3),a.push(l)}else if("Polyline"===r||"Polygon"===r)a=e.getPath();else if("Rectangle"===r){var h=e.getBounds(),c=h.getSouthWest(),u=h.getNorthEast();a=new google.maps.MVCArray,a.push(new google.maps.LatLng(c.lat(),u.lng())),a.push(new google.maps.LatLng(u.lat(),u.lng())),a.push(new google.maps.LatLng(u.lat(),c.lng())),a.push(new google.maps.LatLng(c.lat(),c.lng()))}if(("Circle"===r||"Polygon"===r||"Rectangle"===r)&&a.getAt(0)!==a.getAt(a.getLength()-1)&&a.push(a.getAt(0)),y=t.opts_.adjustZoom===!1?t.pickupVertixes_(a,i):a.getArray(),y.length){var d="",m=e.getOptions(),f=parseInt(256*parseFloat(m.strokeOpacity),10);d="color:"+t.normalizeColor_(m.strokeColor)+f.toString(16),("Circle"===r||"Polygon"===r||"Rectangle"===r)&&(f=parseInt(256*parseFloat(m.fillOpacity,10),10),d+="|fillcolor:"+t.normalizeColor_(m.fillColor)+f.toString(16)),t.isNull(m.strokeWeight)||5!==m.weight&&(d+=(""!==d?"|":"")+"weight:"+m.strokeWeight),o+="&path="+d+"|",t.opts_.usePolylineEncode===!0?(o+="enc:",o+="geometry"in google.maps?google.maps.geometry.encoding.encodePath(y):t.createEncodings_(y)):o+=y.join("|").replace(/[\(\)\s]/g,""),n=!0}}}),y=[],t.overlays_.forEach(function(e,s){y=[];var r,a=e.get("sncCls");if(e.getMap()===t.map_&&"DirectionsRenderer"===a){var l,g=e.getDirections();if(!t.isNull(g)){var p=g.routes;for(s=0;s<p.length;s++)if(l=p[s].overview_path,t.opts_.adjustZoom===!1?(l=new google.maps.MVCArray(l),y=t.pickupVertixes_(l,i)):y=l,y.length){var h="",c=e.getOptions();t.isNull(c)&&(c={strokeOpacity:.5,strokeColor:"#0000FF"});var u=parseInt(256*parseFloat(c.strokeOpacity),10);h="color:"+t.normalizeColor_(c.strokeColor)+u.toString(16),t.isNull(c.strokeWeight)||5!==c.weight&&(h+=(""!==h?"|":"")+"weight:"+c.strokeWeight),o+="&path="+h+"|",t.opts_.usePolylineEncode===!0?(o+="enc:",o+="geometry"in google.maps?google.maps.geometry.encoding.encodePath(y):t.createEncodings_(y)):o+=y.join("|").replace(/[\(\)\s]/g,"");for(r=0;r<p[s].legs.length;r++)(i.contains(p[s].legs[r].start_location)||t.opts_.adjustZoom===!0)&&(o+="&markers=label:"+String.fromCharCode(65+r)+"|color:green|"+t.normalizePos_(p[s].legs[r].start_location)),r!==p[s].legs.length-1||t.opts_.adjustZoom!==!0&&!i.contains(p[s].legs[r].end_location)||(o+="&markers=label:"+String.fromCharCode(65+r+1)+"|color:green|"+t.normalizePos_(p[s].legs[r].end_location));n=!0}}}});var v,w,b,C,M="",k="",P={},z={},S=0;t.overlays_.forEach(function(e){e.getMap()===t.map_&&"Marker"===e.get("sncCls")&&(v=e.getPosition(),(i.contains(v)===!0||t.opts_.adjustZoom===!0)&&(M="",w=e.get("ssSize"),t.isNull(w)||(w=w.toLowerCase(),("tiny"===w||"mid"===w||"small"===w)&&(M+=(""!==M?"|":"")+"size:"+w)),b=e.get("ssCharacter"),t.isNull(b)||"tiny"===w||b.match(/^[a-zA-Z0-9]/)&&(M=0/0+b.substr(0,1).toUpperCase()),C=e.get("ssColor"),t.isNull(C)||(M+=(""!==M?"|":"")+"color:"+t.normalizeColor_(C)),6>S&&(k=e.getIcon(),t.isNull(k)||(k=e.get("iconUrl"),M+=(""!==M?"|":"")+"icon:"+k,k in z||(z[k]=S++),t.isNull(e.getShadow())&&(M+=(""!==M?"|":"")+"shadow:false"))),M in P||(P[M]=""),v=t.normalizePos_(v),P[M]+=(""!==P[M]?"|":"")+v))});var x;for(x in P)x in P&&(o+="&markers="+x+(""!==x?"|":"")+P[x],n=!0);var H=t.map_.getZoom();return(t.opts_.adjustZoom===!1||n===!1)&&(H>20&&(H="21+"),o+="&zoom="+H),e!==!1&&(t.isNull(e)&&(e=t.map_.getCenter()),o+="&center="+t.normalizePos_(e)),o+="&sensor="+t.sensor_,o.length>2e3&&(window.alert("Error: the request url is too long!"),o=""),t.imgUrl_=o,o},this.circlePoint_=function(e,t,o){var i,n,s,r,a=6371,l=o/a;return t=t*Math.PI/180,i=e.lng()*Math.PI/180,n=e.lat()*Math.PI/180,r=Math.asin(Math.sin(n)*Math.cos(l)+Math.cos(n)*Math.sin(l)*Math.cos(t)),s=i+Math.atan2(Math.sin(t)*Math.sin(l)*Math.cos(n),Math.cos(l)-Math.sin(n)*Math.sin(r)),r=180*r/Math.PI,s=180*s/Math.PI,new google.maps.LatLng(r,s)},this.pickupVertixes_=function(e,t){var o=[],i=[],n=new Array(e.getLength());o.length=e.getLength(),n[0]=t.contains(e.getAt(0)),o[0]=0,n[0]===!0&&(i.push(e.getAt(0)),o[0]=1);var s,r;for(s=1;s<e.getLength();s++)o[s]=0,n[s]=t.contains(e.getAt(s)),n[s-1]===!0||n[s]===!0?(n[s-1]===!1&&0===o[s-1]&&i.push(e.getAt(s-1)),i.push(e.getAt(s)),o[s]=1):(r=new google.maps.LatLngBounds(e.getAt(s-1),e.getAt(s)),n[s]=t.intersects(r),n[s]===!0?(n[s-1]===!1&&0===o[s-1]&&i.push(e.getAt(s-1)),i.push(e.getAt(s)),o[s]=1):n[s-1]===!0&&(0===o[s-1]&&i.push(e.getAt(s-1)),i.push(e.getAt(s)),o[s]=1));return i},this.normalizePos_=function(e){return e.toUrlValue().replace(/[^0-9\.\,\-]/,"")},this.normalizeColor_=function(e){return e.replace("#","0x")},this.setOptions=function(e){var o,i={buttonLabelHtml:"Say cheese!",popupLabelHtml:"",mapType:"",size:"",hidden:!1,adjustZoom:!1,adjustCenter:!1,language:"",format:"png",usePolylineEncode:!0,controlPositon:google.maps.ControlPosition.TOP_RIGHT,positon:null};if(t.isNull(e))e=i;else for(o in i)!(o in e)&&o in i&&(e[o]=i[o]);t.opts_=e},this.showPopup=function(e){var o=null;t.isNull(e)||t.setOptions(e),t.isNull(e)||"position"in e&&(o=e.position);var i,n,s=t.getImage(o);n=document.getElementsByTagName("body")[0],i=t.getPageSize_();var r=t.createDiv_({left:0,top:0,width:i.width+"px",height:i.height+"px",backgroundColor:"black",margin:0,padding:0,MozUserSelect:"none",WebkitUserSelect:"none",visibility:"hidden"}),a=new Date,l="p"+a.getTime();r.name=l,r.id=l,n.appendChild(r);var g='var ele=document.getElementById("'+l+'");ele.parentNode.removeChild(ele);ele=document.getElementById("tbl_'+l+'");ele.parentNode.removeChild(ele);',p="<table class='snapshotcontrol_popup'><tbody>";"popupLabelHtml"in t.opts_&&(p+="<thead><tr><th style='text-align:left'><div id='title'>"+t.opts_.popupLabelHtml+"</div></th></tr></thead>"),p+="<tr><td style='text-align;center;'><center><img src='"+s+"' style='border:1px solid black;'></center></td></tr><tr><td><input type='text' style='width:"+t.mapImgSize.width+"px;' value='"+s+"'></td></tr><tr><td><center><input type='button' value='close' onclick='javascript:"+g+"'></center></td></tr></tbody></table>";var h,c,u=t.getHtmlSize(p);h=u.width+10,h<t.mapImgSize.width&&(h=t.mapImgSize.width+10),c=u.height+10,c<t.mapImgSize.height&&(c=t.mapImgSize.height+70);var d=t.createDiv_({left:0,top:0,width:h+"px",height:c+"px"});d.style.backgroundColor="white",d.style.width=0,d.style.height=0,d.style.padding="5px",d.style.border="1px solid black",d.id="tbl_"+l,d.name="tbl_"+l,d.style.left=Math.floor(i.width-h)/2+"px",d.style.top=Math.floor(i.height-c)/2+"px",d.innerHTML=p,d.style.left=Math.floor(i.width/2)+"px",n.appendChild(d);var m=function(e,t){e.style.filter="alpha(opacity="+t+")",e.style.mozOpacity=t/100,e.style.opacity=t/100},f=function(e,o,n,s){m(e,o),o+=s,n>o?setTimeout(function(){f(e,o,n,s)},10):setTimeout(function(){t.openboard_(d,"step1",h,c,i)},400)};m(r,0),f(r,1,80,10),r.style.visibility="visible"},this.openboard_=function(e,o,i,n,s){var r,a,l=arguments;if("step1"===o){if(a=e.offsetHeight+Math.floor(n/10),a>=n&&(a=n),e.style.height=a+"px",a===n)return o="step2",void setTimeout(function(){l.callee.apply(t,l)},100)}else if(r=e.offsetWidth+Math.floor(i/10),r>=i&&(r=i),e.style.left=(s.width-r)/2+"px",e.style.width=r+"px",r===i)return;setTimeout(function(){l.callee.apply(t,l)},30)},this.createEncodings_=function(e){var t=0,o=0,i=0,n="",s=0,r=0;for(t=0;t<e.length;++t){var a=e[t],l=a.lat(),g=a.lng(),p=Math.floor(1e5*l),h=Math.floor(1e5*g);s=p-o,r=h-i,o=p,i=h,n+=this.encodeSignedNumber_(s)+this.encodeSignedNumber_(r)}return n},this.encodeSignedNumber_=function(e){var t=e<<1;return 0>e&&(t=~t),this.encodeNumber_(t)},this.encodeNumber_=function(e){for(var t="";e>=32;)t+=String.fromCharCode((32|31&e)+63),e>>=5;return t+=String.fromCharCode(e+63)},this.getPageSize_=function(){var e,t,o=0,i=0;window.innerHeight&&window.scrollMaxY?(e=window.innerWidth+window.scrollMaxX,t=window.innerHeight+window.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(e=document.body.scrollWidth,t=document.body.scrollHeight):(e=document.body.offsetWidth,t=document.body.offsetHeight);var n,s;return self.innerHeight?(n=document.documentElement.clientWidth?document.documentElement.clientWidth:self.innerWidth,s=self.innerHeight):document.documentElement&&document.documentElement.clientHeight?(n=document.documentElement.clientWidth,s=document.documentElement.clientHeight):document.body&&(n=document.body.clientWidth,s=document.body.clientHeight),o=s>t?s:t,i=n>e?e:n,new google.maps.Size(i,o)},this.setMap=function(e){t.map_=e,t.opts_.hidden===!1&&(t.shutterBtn_=t.createBtn_(t.opts_.buttonLabelHtml,function(){t.showPopup()}),t.map_.controls[t.opts_.controlPositon].push(t.shutterBtn_))},this.setOptions(e);var o,i,n=document.getElementsByTagName("script"),s=!1,r="",a="";for(i=0;i<n.length;i++){var l=n[i];if(o=l.src.match(/^http:\/\/maps\.google\.([^\/]+)\/maps\/api\/js\?&(?:amp;)?sensor=([^\&]+)/gi),null!==o){r=RegExp.$1,s=RegExp.$2,o=l.src.match(/^http:\/\/maps\.google\..*?&(?:amp;)?libraries=([^\&]+)/gi),null!==o&&(a=RegExp.$1);break}}this.sensor_=s||!1,this.server_=r||"maps.google.com",this.libraries=a||"",t.isNull(e)||t.isNull(e.map)||t.setMap(e.map),this.setHookProcForMarker_("Marker"),this.setHookProc_("Polyline"),this.setHookProc_("Polygon"),this.setHookProc_("Circle"),this.setHookProc_("Rectangle"),this.setHookProc_("DirectionsRenderer"),this.setHookArg_("MarkerImage"),this.setHookArg_("StyledMapType")}