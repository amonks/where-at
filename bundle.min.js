function initialize(){var e={disableDefaultUI:!0,panControl:!1,zoomControl:!1,zoom:10,mapTypeControl:!1,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}};map=new google.maps.Map(document.getElementById("map-canvas"),e),draw(),search(),saveControl();var o={map:map,position:new google.maps.LatLng(41.880454799999995,-87.6251393)};map.setCenter(o.position),load()}function draw(){drawingManager.setMap(map),google.maps.event.addListener(drawingManager,"overlaycomplete",function(e){var o="|";switch(e.type){case google.maps.drawing.OverlayType.MARKER:o=o+"m"+(e.overlay.getPosition()+""),constructMarker(o);break;case google.maps.drawing.OverlayType.RECTANGLE:o=o+"r"+(e.overlay.getBounds()+"");break;case google.maps.drawing.OverlayType.CIRCLE:o=o+"c"+(e.overlay.getCenter()+""),o+=e.overlay.getRadius()+"";break;default:path=e.overlay.getPath(),o+="p";for(var a=0;a<path.length;a++)o+=path.getAt(a)+";";constructPolyline(o)}console.log(o),save.add(o)})}function constructPolyline(e){var o,a=e.replace("p","").replace(/\(/g,"").replace(/\)/g,"").split(";");console.log(a);for(var t=new google.maps.MVCArray,n=a.length-2;n>=0;n--){console.log(a[n].split(", "));var o=a[n].split(", ");t.push(new google.maps.LatLng(parseFloat(o[0]),parseFloat(o[1])))}new google.maps.Polyline({path:t,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:5,map:map})}function constructMarker(e){var o=e.replace("m","").replace(/\(/g,"").replace(/\)/g,"").split(", "),a=new google.maps.MVCArray;a.push(new google.maps.LatLng(parseFloat(o[0]),parseFloat(o[1]))),a.forEach(function(e){createMarker({map:map,position:e})})}function createMarker(e){var o=new google.maps.Marker(e);return google.maps.event.addListenerOnce(o,"click",function(){o.setMap(null),o=null}),o}function constructZoom(e){var o=e.replace("z","").replace(/\(/g,"").replace(/\)/g,"");map.setZoom(parseInt(o))}function constructCenter(e){var o=e.replace("c","").replace(/\(/g,"").replace(/\)/g,"");console.log(o);var a=o.split(", ");map.setCenter(new google.maps.LatLng(parseFloat(a[0]),parseFloat(a[1])))}function getQueryString(){if(-1==window.location.href.indexOf("?"))return null;var e=window.location.href.slice(window.location.href.indexOf("?")+1);return e.length<=1?null:atob(e)}function getOverlayArray(){return getQueryString().split("|")}function load(){if(null!==getQueryString())for(var e=getOverlayArray(),o=e.length-1;o>=0;o--)-1!==e[o].indexOf("zoom")&&constructZoom(e[o]),-1!==e[o].indexOf("center")&&constructCenter(e[o]),-1!==e[o].indexOf("polyline")&&(constructPolyline(e[o]),save.add(e[o])),-1!==e[o].indexOf("marker")&&(constructMarker(e[o]),save.add(e[o]))}function SaveControl(e){e.style.padding="5px";var o=document.createElement("div");o.style.backgroundColor="white",o.style.borderStyle="solid",o.style.borderWidth="2px",o.style.cursor="pointer",o.style.textAlign="center",o.title="Click to set the map to Home",e.appendChild(o);var a=document.createElement("div");a.style.fontFamily="Arial,sans-serif",a.style.fontSize="12px",a.style.paddingLeft="4px",a.style.paddingRight="4px",a.innerHTML="<b>Share</b>",o.appendChild(a),google.maps.event.addDomListener(o,"click",function(){save.save()})}function SaveData(){this.drawLog=""}function saveControl(){{var e=document.createElement("div");new SaveControl(e,map)}e.index=1,map.controls[google.maps.ControlPosition.TOP_RIGHT].push(e)}function search(){var e=[],o=document.getElementById("pac-input");map.controls[google.maps.ControlPosition.TOP_LEFT].push(o);var a=new google.maps.places.SearchBox(o);google.maps.event.addListener(a,"places_changed",function(){for(var o,t=a.getPlaces(),n=0;o=e[n];n++)o.setMap(null);e=[];for(var r,n=(new google.maps.LatLngBounds,0);r=t[n];n++){var l={url:r.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)},o=new google.maps.Marker({map:map,icon:l,title:r.name,position:r.geometry.location});e.push(o),r.geometry.viewport?map.fitBounds(r.geometry.viewport):(map.setCenter(r.geometry.location),map.setZoom(17))}}),google.maps.event.addListener(map,"bounds_changed",function(){var e=map.getBounds();a.setBounds(e)});({map:map,position:new google.maps.LatLng(41.880454799999995,-87.6251393)})}var map,drawingManager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYLINE,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_LEFT,drawingModes:[google.maps.drawing.OverlayType.POLYLINE,google.maps.drawing.OverlayType.MARKER]},polylineOptions:{strokeWeight:5,strokeOpacity:.5,strokeColor:"#ff0000",clickable:!1,zIndex:1,editable:!1},polygonOptions:{editable:!1},markerOptions:{editable:!1}}),save=new SaveData;SaveData.prototype.save=function(){console.log(this.base64()),longUrl=window.location.href.split("?")[0]+"?"+this.base64(),jQuery.urlShortener({longUrl:longUrl,success:function(e){alert(e),console.log(e),window.location=e},error:function(e){alert(JSON.stringify(e))}})},SaveData.prototype.base64=function(){return btoa(this.metadata()+this.drawLog)},SaveData.prototype.metadata=function(){var e="";return e+="z"+map.zoom+"|",e+="c"+map.getCenter().toString()+"|"},SaveData.prototype.add=function(e){this.drawLog+=e},google.maps.event.addDomListener(window,"load",initialize);