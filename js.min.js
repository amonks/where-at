function initialize(){var e={disableDefaultUI:!0,panControl:!1,zoomControl:!1,zoom:10,mapTypeControl:!1,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}};map=new google.maps.Map(document.getElementById("map-canvas"),e),draw(),search(),saveControl(),clearControl();var o={map:map,position:new google.maps.LatLng(41.880454799999995,-87.6251393)};map.setCenter(o.position),load()}function clearControl(){var e=document.createElement("div");new ClearControl(e,map),e.index=1,map.controls[google.maps.ControlPosition.BOTTOM_LEFT].push(e)}function ClearControl(e){e.style.padding="5px";var o=document.createElement("div");o.style.backgroundColor="white",o.style.borderStyle="solid",o.style.borderWidth="2px",o.style.cursor="pointer",o.style.textAlign="center",o.title="Click to set the map to Home",e.appendChild(o);var t=document.createElement("div");t.style.fontFamily="Arial,sans-serif",t.style.fontSize="12px",t.style.paddingLeft="4px",t.style.paddingRight="4px",t.innerHTML="<b>Clear</b>",o.appendChild(t),google.maps.event.addDomListener(o,"click",function(){window.location=window.location.href.split("?")[0]})}function draw(){drawingManager.setMap(map),google.maps.event.addListener(drawingManager,"overlaycomplete",function(e){switch(output="",e.type){case google.maps.drawing.OverlayType.MARKER:output=output+"m"+(e.overlay.getPosition()+""),constructMarker(output);break;default:path=e.overlay.getPath(),output+="p";for(var o=0;path.length>o;o++)output+=path.getAt(o)+";";constructPolyline(output)}output=output.replace(/\(/g,"").replace(/\)/g,"").replace(" ",""),console.log(output),save.add(output)})}function constructPolyline(e){for(var o,t=e.replace("p","").replace(/\(/g,"").replace(/\)/g,"").split(";"),n=new google.maps.MVCArray,a=t.length-2;a>=0;a--){var o=t[a].split(",");n.push(new google.maps.LatLng(parseFloat(o[0]),parseFloat(o[1])))}new google.maps.Polyline({path:n,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:5,map:map})}function constructMarker(e){var o=e.replace("m","").replace(/\(/g,"").replace(/\)/g,"").split(","),t=new google.maps.MVCArray;t.push(new google.maps.LatLng(parseFloat(o[0]),parseFloat(o[1]))),t.forEach(function(e){createMarker({map:map,position:e})})}function createMarker(e){var o=new google.maps.Marker(e);return google.maps.event.addListenerOnce(o,"click",function(){o.setMap(null),o=null}),o}function constructZoom(e){var o=e.replace("z","").replace(/\(/g,"").replace(/\)/g,"");map.setZoom(parseInt(o))}function constructCenter(e){var o=e.replace("c","").replace(/\(/g,"").replace(/\)/g,""),t=o.split(", ");map.setCenter(new google.maps.LatLng(parseFloat(t[0]),parseFloat(t[1])))}function getQueryString(){if(-1==window.location.href.indexOf("?"))return null;var e=window.location.href.slice(window.location.href.indexOf("?")+1);return 1>=e.length?null:atob(e)}function getOverlayArray(){return getQueryString().split("|")}function load(){if(null!==getQueryString())for(var e=getOverlayArray(),o=e.length-1;o>=0;o--)console.log(e[o]),-1!==e[o].indexOf("z")&&constructZoom(e[o]),-1!==e[o].indexOf("c")&&constructCenter(e[o]),-1!==e[o].indexOf("p")&&(constructPolyline(e[o]),save.add(e[o])),-1!==e[o].indexOf("m")&&(constructMarker(e[o]),save.add(e[o]))}function SaveData(){this.drawLog=[]}function saveControl(){var e=document.createElement("div");new SaveControl(e,map),e.index=1,map.controls[google.maps.ControlPosition.BOTTOM_LEFT].push(e)}function SaveControl(e){e.style.padding="5px";var o=document.createElement("div");o.style.backgroundColor="white",o.style.borderStyle="solid",o.style.borderWidth="2px",o.style.cursor="pointer",o.style.textAlign="center",o.title="Click to set the map to Home",e.appendChild(o);var t=document.createElement("div");t.style.fontFamily="Arial,sans-serif",t.style.fontSize="12px",t.style.paddingLeft="4px",t.style.paddingRight="4px",t.innerHTML="<b>Share</b>",o.appendChild(t),google.maps.event.addDomListener(o,"click",function(){save.save()})}function search(){var e=[],o=document.getElementById("pac-input");map.controls[google.maps.ControlPosition.TOP_LEFT].push(o);var t=new google.maps.places.SearchBox(o);google.maps.event.addListener(t,"places_changed",function(){for(var o,n=t.getPlaces(),a=0;o=e[a];a++)o.setMap(null);e=[],new google.maps.LatLngBounds;for(var r,a=0;r=n[a];a++){var l={url:r.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)},o=new google.maps.Marker({map:map,icon:l,title:r.name,position:r.geometry.location});e.push(o),r.geometry.viewport?map.fitBounds(r.geometry.viewport):(map.setCenter(r.geometry.location),map.setZoom(17))}}),google.maps.event.addListener(map,"bounds_changed",function(){var e=map.getBounds();t.setBounds(e)}),{map:map,position:new google.maps.LatLng(41.880454799999995,-87.6251393)}}var map,drawingManager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYLINE,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_LEFT,drawingModes:[google.maps.drawing.OverlayType.POLYLINE,google.maps.drawing.OverlayType.MARKER]},polylineOptions:{strokeWeight:5,strokeOpacity:.5,strokeColor:"#ff0000",clickable:!1,zIndex:1,editable:!1},polygonOptions:{editable:!1},markerOptions:{editable:!1}});(function(e){var o=!1,t=!1;e.getScript("https://apis.google.com/js/client.js",function(){(function n(){gapi.client?(o=!0,gapi.client.setApiKey(e.urlShortener.settings.apiKey),gapi.client.load("urlshortener",e.urlShortener.settings.version,function(){t=!0})):window.setTimeout(n,10)})()}),e.urlShortener=function(n){function a(e){var o={longUrl:e.longUrl},t=gapi.client.urlshortener.url.insert({resource:o});t.execute(function(o){null!=o.id?e.success&&e.success.call(this,o.id):e.error&&e.error.call(this,o.error)})}function r(e){var o={shortUrl:e.shortUrl,projection:e.projection},t=gapi.client.urlshortener.url.get(o);t.execute(function(o){null!=o.longUrl?e.success&&(void 0==e.projection?e.success.call(this,o.longUrl):e.success.call(this,o)):e.error&&e.error.call(this,o.error)})}var l={};e.extend(l,e.urlShortener.settings,n),function i(){o&&t?void 0!=l.longUrl?a(l):void 0!=l.shortUrl&&r(l):window.setTimeout(i,10)}()},e.urlShortener.settings={apiKey:"AIzaSyDIPa8VjR1Iybo-vl60dd3CpSmw2zyMfvA",version:"v1"}})(jQuery);var save=new SaveData;SaveData.prototype.save=function(){console.log(this.base64()),longUrl=window.location.href.split("?")[0]+"?"+this.base64(),jQuery.urlShortener({longUrl:longUrl,success:function(e){alert(e),console.log(e),window.location=e},error:function(e){alert(JSON.stringify(e))}})},SaveData.prototype.base64=function(){return btoa(this.metadata()+this.drawLog.join("|"))},SaveData.prototype.metadata=function(){var e="";return e+="z"+map.zoom+"|",e+="c"+(""+map.getCenter())+"|"},SaveData.prototype.add=function(e){this.drawLog.push(e)},google.maps.event.addDomListener(window,"load",initialize);